# 重要ポイント

## 1. エージェントファースト設計

**概念**: 複雑なタスクは専門エージェントに委任する

```
ユーザー要求 → 適切なエージェント選択 → 専門的な処理 → 結果
```

**ベストプラクティス**:
- 新機能 → `/plan` → `/tdd` → `/code-review`
- バグ修正 → `/tdd` (再現テスト作成) → 修正 → テスト
- リファクタリング → `/plan` → 実装 → `/refactor-clean`

---

## 2. イミュータビリティの厳守

**重要度**: ★★★★★（最重要）

```typescript
// ❌ 絶対に避ける
user.name = 'New Name'
items.push(newItem)

// ✅ 常にこう書く
const updatedUser = { ...user, name: 'New Name' }
const updatedItems = [...items, newItem]
```

**理由**:
- バグの予防
- 予測可能な状態管理
- React等での正しい再レンダリング

---

## 3. テストファースト（TDD）

**ワークフロー**:
```
RED → GREEN → REFACTOR → REPEAT

1. 失敗するテストを書く（RED）
2. テストを通過する最小コードを書く（GREEN）
3. コードを改善する（REFACTOR）
4. 次のテストへ（REPEAT）
```

**カバレッジ目標**:
- 全体: 80%以上
- 重要ビジネスロジック: 100%
- セキュリティ関連: 100%

---

## 4. セキュリティチェックリスト

**コミット前の必須確認**:
- [ ] ハードコードされたシークレットなし
- [ ] すべての入力がバリデーション済み
- [ ] SQL/NoSQLインジェクション対策
- [ ] XSS対策
- [ ] CSRF保護
- [ ] 適切な認証/認可

---

## 5. ファイル構成の原則

**ルール**:
- 1ファイル: 200-400行が理想、最大800行
- 高凝集・低結合
- 機能/ドメイン別に整理（タイプ別ではない）

```
✅ 推奨
src/
├── features/
│   ├── markets/
│   │   ├── MarketList.tsx
│   │   ├── MarketCard.tsx
│   │   └── useMarkets.ts

❌ 非推奨
src/
├── components/
│   ├── MarketList.tsx
│   ├── UserList.tsx
├── hooks/
│   ├── useMarkets.ts
│   ├── useUsers.ts
```

---

## 6. コンテキストウィンドウ管理

**モデル選択戦略**:

| モデル | 用途 | コスト |
|--------|------|--------|
| Haiku 4.5 | 軽量タスク、ペアプログラミング | 安い |
| Sonnet 4.5 | メイン開発作業 | 中程度 |
| Opus 4.5 | 深い推論、アーキテクチャ決定 | 高い |

**コンテキスト残量20%以下での注意**:
- 大規模リファクタリングを避ける
- 新しいセッションを検討
- 重要な情報を要約して保持

---

## 7. Git ワークフロー

**コミットメッセージ形式**:
```
<type>: <description>

type: feat, fix, refactor, docs, test, chore, perf, ci
```

**PRワークフロー**:
1. 計画を立てる（`/plan`）
2. TDDで実装（`/tdd`）
3. コードレビュー（`/code-review`）
4. テスト確認
5. PRを作成

---

## 8. フック活用のポイント

**効果的なフック**:
- **PreToolUse**: 危険な操作をブロック
- **PostToolUse**: 自動フォーマット、警告表示
- **Stop**: 最終チェック（console.log残存確認など）

**注意点**:
- フックでの処理は軽量に
- エラー時のフォールバック考慮
- 過度な制限は生産性低下の原因
