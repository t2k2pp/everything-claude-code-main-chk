---
description: Playwrightでエンドツーエンドテストを生成して実行。テストジャーニーを作成、テストを実行、スクリーンショット/動画/トレースをキャプチャ、アーティファクトをアップロード。
---

# E2Eコマンド

このコマンドは**e2e-runner**エージェントを呼び出し、Playwrightを使用してエンドツーエンドテストを生成、維持、実行します。

## このコマンドがすること

1. **テストジャーニーを生成** - ユーザーフロー用のPlaywrightテストを作成
2. **E2Eテストを実行** - 複数のブラウザでテストを実行
3. **アーティファクトをキャプチャ** - 失敗時のスクリーンショット、動画、トレース
4. **結果をアップロード** - HTMLレポートとJUnit XML
5. **不安定なテストを特定** - 不安定なテストを隔離

## 使用タイミング

`/e2e`を使用する場面:
- 重要なユーザージャーニーのテスト（ログイン、取引、支払い）
- 複数ステップのフローがエンドツーエンドで機能することを確認
- UIインタラクションとナビゲーションのテスト
- フロントエンドとバックエンド間の統合を検証
- 本番デプロイの準備

## テストアーティファクト

テスト実行時、以下のアーティファクトがキャプチャされます:

**すべてのテストで:**
- タイムラインと結果付きHTMLレポート
- CI統合用JUnit XML

**失敗時のみ:**
- 失敗状態のスクリーンショット
- テストの動画録画
- デバッグ用トレースファイル（ステップバイステップ再生）
- ネットワークログ
- コンソールログ

## クイックコマンド

```bash
# すべてのE2Eテストを実行
npx playwright test

# 特定のテストファイルを実行
npx playwright test tests/e2e/markets/search.spec.ts

# ヘッドモードで実行（ブラウザを表示）
npx playwright test --headed

# テストをデバッグ
npx playwright test --debug

# テストコードを生成
npx playwright codegen http://localhost:3000

# レポートを表示
npx playwright show-report
```

## ベストプラクティス

**する:**
- ✅ 保守性のためPage Object Modelを使用
- ✅ セレクターにdata-testid属性を使用
- ✅ 任意のタイムアウトではなくAPIレスポンスを待つ
- ✅ 重要なユーザージャーニーをエンドツーエンドでテスト
- ✅ mainにマージする前にテストを実行
- ✅ テストが失敗したらアーティファクトをレビュー

**しない:**
- ❌ 脆弱なセレクターを使用（CSSクラスは変更される可能性）
- ❌ 実装の詳細をテスト
- ❌ 本番環境に対してテストを実行
- ❌ 不安定なテストを無視
- ❌ 失敗時のアーティファクトレビューをスキップ
- ❌ すべてのエッジケースをE2Eでテスト（ユニットテストを使用）

## 他のコマンドとの統合

- `/plan`を使用してテストすべき重要なジャーニーを特定
- `/tdd`をユニットテストに使用（より高速、より詳細）
- `/e2e`を統合とユーザージャーニーテストに使用
- `/code-review`でテスト品質を確認

## 関連エージェント

このコマンドは`e2e-runner`エージェントを呼び出します:
`~/.claude/agents/e2e-runner.md`
